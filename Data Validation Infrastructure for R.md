# Data Validation Infrastructure for R
Mark P. J. van der Loo & Edwin de Jonge

## Abstract

統計解析では、生データから出力に至るまで、ドメインの知識に照らしてデータの品質をチェックすることが一般的に行われている。Rパッケージvalidateは、専門家の知識を検証ルールという形で取り込み、適用することにより、この作業を容易にする：変数、レコード、またはデータセットに対する論理的制約であり、さらなる分析のための有効な入力とみなされる前に満たされるべきものである。validateパッケージでは、検証ルールは、データまたはデータセットのバージョンに対して、操作、調査、対決が可能な計算オブジェクトである。対決の結果は、さらなる調査、要約、可視化のために利用できる。また、検証ルールにはメタデータやドキュメントを付与することができ、テキストファイルや表形式などの外部ソースから保存したり取得したりすることができる。このデータ検証インフラストラクチャは、データセットの様々なバージョンや、検証ルールによってパラメータ化されたデータ修正アルゴリズムに再利用できる、データ品質要件の体系的かつユーザー定義の定義を可能にする。

1. はじめに 
データ分析では、データが専門分野の知識に基づく仮定を満たしているかどうかをチェックする必要があります。生データであれ、クリーンアップされたデータであれ、統計計算の出力であれ、データ分析者はあらゆる段階でデータセットを精査し、報告やさらなる計算に使用できることを確認しなければならない。データセットの品質を調査し、目的に合っているかどうかを判断するこの手順を、私たちは「データバリデーション」手順と呼んでいる。データの作成、収集、処理には様々な問題が起こりうる。そのため、さまざまな種類のチェックを行うことができる。通常、データ構造やデータ型に関連する技術的なチェックと、データが記述するトピックに関連するチェックとに区別される。技術的なチェックの例としては、「年齢」変数が数値であるかどうか、必要な変数がすべて揃っているかどうか、R変数の識別2データ検証基盤（主キー）がレコード間で一意であるかどうか、などがある。主題の知識に関連するチェックの例としては、範囲のチェック（人の年齢は0から例えば120の間でなければならない）、変数間の一貫性のチェック（18歳未満の人は結婚できない）などがある。単純な比較で済むチェックもあれば、複雑な計算を伴うチェックもある。例えば、ある経済部門の売上高利益率の平均値が、当四半期と前年同期で10％以上変化していないことを確認するチェックを考えてみよう。そのためには、2四半期分の利益と売上高のデータを用意し、その比率を計算（ゼロで割るなどの例外を考慮）して平均化し、その差の絶対値を一定値（この場合は0.1）と比較することになる。データ検証はこのように一般的で多様な作業であるため、データ検証の手順を体系化し整理できる専用のツールを使用することが望まれる。R言語（R Core Team 2021）には、これを体系的に支援することを目的とした最近の貢献がいくつかある。Iannone and Vargas (2021)のpointblankパッケージは、ハードコードされた多くの検証チェックに対してデータをテストすることができる。例えば、ある列の値が正であるか、非負であるか、あるいはある範囲にあるかどうかを判断するための個別の関数がある。dataMaidパッケージ（Petersen and Ekstrøm 2019）は、データに関する一般的な問題の検出を目的とした一般的な要約レポートと図を作成します。検出された問題には、特殊な値（Infなど）の存在、空文字列、潜在的な外れ値の特定などがある。Fischetti (2021)はassertrパッケージを発表し、「述語」と呼ばれる多くの定義済み（およびパラメータ化）データチェックに対してデータをチェックすることができるようにした。これは特に、Bache and Wickham (2020)のmagrittr "forward pipe "演算子のような関数合成演算子と併用することを想定している。述語の結果に応じてカスタム関数が評価されるため、assertrの有用性はtry-catchメカニズムに匹敵します。editrulesパッケージ（De Jonge and Van der Loo 2018）は、ユーザーが独自のチェック（「編集ルール」と呼ばれる）を指定し、データに適用することを可能にする。指定できるチェックは、変数に対する単純なレコード内線形等式と不等式、および特定の条件付きチェック（例えば、IF age < 18 THEN married == FALSE）に限定されています。validateパッケージ(Van der Loo and De Jonge 2021b)は、以下のように発表した。


